{% extends "base.html" %}

{% block content %}

{% if size is undefined %}
    {% set size = 19 %}
{% endif %}

<style>

.goban {
    width: {{20 * size}}px;
    height: {{20 * size}}px;
    margin: 10px;
    border: 2px solid;
    padding: 10px;
    resize: both;
    overflow: auto;
}

.goban-row{
    margin: 0;
    height: {{100.0 / size}}%;
    width: 100%;
}

.gopoint {
   float: left;
   background: #CB9546;
   height: 100%;
   width: {{100.0 / size}}%;
   position: relative;
   /* z-index: 500; the stack order: foreground */
   margin: 0;
}

.board_line {
    background: #000000;
}

.board_line_vertical{
    left: 45%;
    position: absolute;
    height: 55%;
    width: 10%;
}

.board_line_bottom_vertical{
    top: 45%;
}

.board_line_horizontal{
    top: 45%;
    position: absolute;
    height: 10%;
    width: 55%;
}

.board_line_right_horizontal{
    left: 50%;
}

.stone {
  width: 80%;
  height:80%;
  border: 2px solid #ddd;
  border-radius: 80%;
  position: absolute;
  left: 0;
  top: 0;
  box-shadow: 0 0 5px rgba(0,0,0,0.8);
  box-shadow: inset 0 0 5px rgba(0,0,0,0.8);
}

.placement {
  /* This kind of needs to be width and height 100% so that hovering anywhere
     within the point works, otherwise the placement element has no width or
     height and hence is never hovered over. We also require it to have zero
     opacity so that the actual go point behind it (the color of the go board
     itself) is visible.
  */
  opacity: 0;
  width: 100%;
  height: 100%;
}
.placement:hover {
  opacity: 0.7;
  width: 80%;
  height:80%;
  border: 2px solid #ddd;
  border-radius: 80%;
  position: absolute;
  left: 0;
  top: 0;
  box-shadow: 0 0 5px rgba(0,0,0,0.8);
  box-shadow: inset 0 0 5px rgba(0,0,0,0.8);
}

.dead{
    opacity: 0.5;
}

.gopoint .black{
    background: #000000;
}

.gopoint .white{
    background: #ffffff;
}

.neutral{
    background: #f52712;
}

.territory{
    width: 30%;
    height: 30%;
    position: absolute;
    left:35%;
    top:35%;
}

.handicappoint {
  width: 30%;
  height:30%;
  background: #000000;
  border-radius: 100%;
  position: absolute;
  left: 35%;
  top: 35%;
  box-shadow: 0 0 5px rgba(0,0,0,0.8);
  box-shadow: inset 0 0 5px rgba(0,0,0,0.8);
}

.last-played {
  width: 30%;
  height:30%;
  background: #f52712;
  border-radius: 100%;
  position: absolute;
  left: 35%;
  top: 35%;
  box-shadow: 0 0 5px rgba(0,0,0,0.8);
  box-shadow: inset 0 0 5px rgba(0,0,0,0.8);
}

#board-area{
   float:left;
   background: #598385;
}

.game-chat{
   width: 50%;
   float: left;
   background: #C96253;
}

.chat-comments{
    border: 1px solid black;
}

.chat-comment-anonymous{
    border: 1px solid #CFBA48;
    color: #5F215A;
    background: #FFEE91;

}

.chat-comment-black{
    border: 1px solid #CFBA48;
    color: #952D2D;
    background: #B0E1DF;
}

.chat-comment-white{
    border: 1px solid #CFBA48;
    color: #B0E1DF;
    background: #952D2D;
}

#chat-form{
}

/* If we wish to display a stone away from the board, for example in the
   heading to show who is black/white or to show captures then we have to
   put a 'stone' element within a 'stone-container' otherwise the stone
   element will take on a percentage (80 at time of writing) of its parent
   element.
*/
.stone-image{
    display:inline-block;
    width: 1em;
    height: 1em;
    border: 2px solid #ddd;
    border-radius: 80%;
    position: relative;
    box-shadow: 0 0 5px rgba(0,0,0,0.8);
    box-shadow: inset 0 0 5px rgba(0,0,0,0.8);
}


#match-info{
    background: #925F7D;
}

</style>

<div id="match-info">
       {% if color_turn == 'black' %}
            {% set black_text_property = 'underline' %}
            {% set white_text_property = 'none' %}
       {% elif color_turn == 'white' %}
            {% set black_text_property = 'none' %}
            {% set white_text_property = 'underline' %}
       {% else %}
            {% set black_text_property = 'none' %}
            {% set white_text_property = 'none' %}
       {% endif %}
       <span style="color:black; text-decoration:{{black_text_property}};">{{black_email}}</span>
       <div style="display:inline"><div class="stone-image" style="background:#000000"></div>
                                   <span style="color:#f52712;"> VS </span>
                                   <div class="stone-image" style="background:#ffffff"></div>
       </div>
       <span style="color:white; text-decoration:{{white_text_property}};">{{white_email}}</span>
</div><!-- end of match info -->

<div id="content">
<div id="board-area">
<div id="board"></div>
{% if on_turn %}
<form id="main_form"
      method="POST" action="{{ url_for('play', game_no=game_no) }}">
    {{ form.hidden_tag() }}
    <button type="submit"
            class="confirm_button" name='confirm_button'>Confirm</button>

    {% if with_scoring %}
    <button type="button"
            class="resume_button" name='resume_button'>Resume</button>
    {% else %}  <!-- if with_scoring -->
    <button type="button"
            class="pass_button"  name='pass_button'>Pass</button>
    <button type="submit"
            class="resign_button" name='resign_button'>Resign</button>
    {% endif %}  <!-- if with_scoring -->

</form>
{% else %}  <!-- if on_turn -->
<form method="POST" action="/404">
    <!-- provide a form to supply the hidden data field -->
    {{ form.hidden_tag() }}
</form>
{% endif %}  <!-- if on_turn -->

</div> <!-- end of board-area -->

<div class="game-chat">
    <div class="chat-comments" style="max-height: 500px; overflow-y: scroll;">
      {% for comment in comments %}
        {% if comment.speaker == black_email %}
           <div class="chat-comment-black">
        {% elif comment.speaker == white_email %}
           <div class="chat-comment-white">
        {% else %}
           <div class="chat-comment-anonymous">
        {% endif %}
        {{comment.content}}</div>
      {% endfor %}
    </div>
<form id="chat-form"
      method="POST" action="{{ url_for('comment', game_no=game_no) }}">
    {{ chatform.hidden_tag() }}
    {{ chatform.comment.label }} {{ chatform.comment() }}
    <button type="submit"
            class="comment_button" name='comment_button'>Comment</button>
</form>

</div><!-- end of game-chat -->
</div><!-- end of content -->

{% endblock %}

{% block page_scripts %}
<script>
 (function() {
     var onTurn = "{{ on_turn }}";
     if (onTurn === "True") {
         window.tesuji_charm.onTurn = true;
     } else {
         window.tesuji_charm.onTurn = false;
     }
     console.log(window.tesuji_charm.onTurn);
 })();
</script>
<script>
 $('.chat-comments').scrollTop($('.chat-comments')[0].scrollHeight);
</script>
<script src="/static/compiled-js/go_rules.js"></script>
<script src="/static/compiled-js/smartgame.js"></script>
<script src="/static/compiled-js/game_common.js"></script>
{% if with_scoring %}
<script src="/static/compiled-js/game_marking.js"></script>
<script>
window.tesuji_charm.game_marking.initialize();
</script>
{% else %}  <!-- if with_scoring -->
<script src="/static/compiled-js/game_basic.js"></script>
<script>
window.tesuji_charm.game_basic.initialize();
</script>
{% endif %} <!-- if with_scoring -->
{% endblock %}
